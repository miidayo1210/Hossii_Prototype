# スペース URL 機能 仕様

> 最終更新: 2026-02-25

---

## 概要

スペースごとの固有 URL を生成し、QR コード経由でそのスペースに直接アクセスできるようにする機能。
個人ユーザーとコミュニティの両方がスペースを持てる構造を前提とする。

---

## 課題

- 現状、`hossii.com/#screen` にアクセスすると全ユーザーの投稿が表示される状態になっている
- スペースに固有の URL がないため、特定のスペースへ他者を誘導する手段がない
- QR コードを使った「場への参加導線」が存在しない

---

## 実現したいこと

- スペースを作成すると、スペース固有の URL を自動生成する
- `hossii.com/s/[spaceURL]` にアクセスすると、そのスペースのスペースビューに遷移する
- QR コードを表示・共有できるようにし、スキャンしたユーザーがそのスペースに自由投稿できるようにする

---

## URL 設計

| エンティティ | URL パターン | 例 |
|------------|------------|-----|
| スペース | `hossii.com/s/[spaceURL]` | `hossii.com/s/mornings-team` |
| コミュニティ | `hossii.com/c/[communityURL]` | `hossii.com/c/acme-corp` |

### spaceURL の仕様

| 項目 | 内容 |
|------|------|
| 形式 | 半角英数字・ハイフン（例: `mornings-team`） |
| 文字数 | 3〜40文字 |
| 一意性 | グローバルでユニーク |
| 変更 | スペース作成後も変更可能（旧URLは無効化） |
| 自動生成 | 未入力の場合はランダム文字列を自動付与 |

---

## エンティティ設計

### スペース（Space）

```ts
type Space = {
  id: string;           // 内部ID（変更不可）
  spaceURL: string;     // パブリックURL用スラッグ（変更可）
  name: string;         // 表示名
  ownerId: string;      // 作成者ID（個人ユーザーまたはコミュニティID）
  ownerType: 'user' | 'community';
  isPublic: boolean;    // 公開/非公開
  createdAt: Date;
};
```

### コミュニティ（Community）

```ts
type Community = {
  id: string;
  communityURL: string; // パブリックURL用スラッグ
  name: string;
  adminIds: string[];   // 管理者ユーザーID一覧
  spaceIds: string[];   // 所属スペースID一覧
  isPaid: boolean;      // 有料プラン判定
  createdAt: Date;
};
```

---

## 機能仕様

### 1. スペース URL の生成

| 項目 | 内容 |
|------|------|
| タイミング | スペース作成時に生成 |
| 入力 | 任意（未入力の場合は自動生成） |
| バリデーション | 重複チェック・使用可能文字チェック |
| 表示 | スペース設定画面でURL確認・変更が可能 |

### 2. QR コード表示

| 項目 | 内容 |
|------|------|
| 生成対象 | `hossii.com/s/[spaceURL]` の URL |
| 表示場所 | スペース設定画面（`#settings`）または専用シェアモーダル |
| 操作 | QR コード画像のダウンロード・コピーが可能 |
| 未ログインアクセス | QR スキャン後は匿名ユーザーとしてそのまま投稿可能 |

### 3. URL 経由のスペースアクセス

| 状態 | 挙動 |
|------|------|
| スペースが存在する | そのスペースのスペースビューへ遷移 |
| スペースが存在しない | 「スペースが見つかりません」エラー画面を表示 |
| 非公開スペース | 招待済みユーザーのみアクセス可（未招待は弾く） |
| 未ログインユーザー | 匿名ユーザーとして閲覧・投稿可能（匿名仕様に準拠） |

---

## 個人ユーザーとコミュニティの違い

| 項目 | 個人ユーザー | コミュニティ |
|------|------------|------------|
| スペース数 | 制限あり（例: 最大3つ） | 複数スペース管理可 |
| 管理者 | 作成者のみ | 複数管理者を設定可能 |
| URL 名前空間 | `/s/[spaceURL]` | `/c/[communityURL]` 配下 + `/s/[spaceURL]` |
| 作成方法 | 通常フローで作成可能 | 専用の招待リンクから作成（有料機能） |
| 料金 | 無料 | 有料プラン |

---

## 考慮すべきこと

- `spaceURL` は変更可能にするが、変更時は旧URLを無効化するため、配布済みのQRコードが失効することをユーザーに警告する
- コミュニティURLのスラッグと、スペースURLのスラッグは名前空間が異なるため衝突しない
- 匿名ユーザーがQRコードからアクセスした場合、投稿時のニックネーム設定フローをシンプルにする必要がある（匿名利用仕様と連動）
- スペースの公開設定（`isPublic`）によりアクセス制限を行う設計にしておく

---

## 未実装（将来対応）

- QR コード生成・表示 UI
- `spaceURL` のルーティング（現状はハッシュベース）
- コミュニティ作成フロー（有料プラン）
- 非公開スペースへの招待・アクセス制御
- 旧 URL の無効化・リダイレクト処理
